-   name: Remove Packages via APT for Deployment
    package:
        name: '{{ deploy_package_remove }}'
        state: absent
        purge: yes
    become: yes
    register: packages_remove
    with_items: '{{ deploy.packages.remove|default({}) }}'
    loop_control:
        loop_var: deploy_package_remove
    when: (deploy.packages.remove is defined and deploy.packages.remove is not none and deploy.packages.remove | trim != '')
    tags:
    - deploy
    - apt
    - packages_apt
    - packages_apt_remove
-   name: Install Packages via APT for Deployment
    package:
        name: '{{ deploy_p }}'
        state: '{{ deploy.packages.state|default(''present'') }}'
    become: yes
    register: packages_install
    with_items: '{{ deploy.packages.install|default({}) }}'
    loop_control:
        loop_var: deploy_p
    when: (deploy.packages.install is defined and deploy.packages.install is not none and deploy.packages.install | trim != '')
    tags:
    - deploy
    - apt
    - packages_apt
    - packages_apt_install
